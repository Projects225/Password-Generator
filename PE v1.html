<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <title>Password Excode</title>
  <style>
    body { font-family: monospace; background: #111; color: #eee; padding: 20px; }
    label { display: block; margin-top: 10px; }
    input { width: 300px; padding: 5px; margin-top: 5px; }
    button { margin-top: 15px; padding: 8px 15px; cursor: pointer; }
    pre { background: #222; padding: 15px; border-radius: 8px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>Password Excode</h2>
  
  <label>Key:</label>
  <input type="text" id="text">

  <label>Times:</label>
  <input type="number" id="times" min="1" value="1">

  <label>Width:</label>
  <input type="number" id="width" min="1" value="80">

  <label>Row (Optional):</label>
  <input type="number" id="line" min="1">

  <button onclick="encodeBase85()">Zakóduj</button>

  <h3>Code:</h3>
  <pre id="output"></pre>

  <script>
    // RFC1924 / Z85 character set (rovnaký ako Python base64.b85encode)
    const Z85_CHARS = 
      "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!#$%&()*+-;<=>?@^_`{|}~";

    // Encode byte array to Z85/Base85 (RFC1924)
    function z85Encode(bytes) {
      let remainder = bytes.length % 4;
      if (remainder !== 0) {
        let padding = 4 - remainder;
        let tmp = new Uint8Array(bytes.length + padding);
        tmp.set(bytes);
        bytes = tmp;
      }
      let result = "";
      for (let i = 0; i < bytes.length; i += 4) {
        let value = 
          (bytes[i] << 24) >>> 0 |
          (bytes[i+1] << 16) |
          (bytes[i+2] << 8) |
          (bytes[i+3]);
        let encoded = "";
        for (let j = 0; j < 5; j++) {
          encoded = Z85_CHARS[value % 85] + encoded;
          value = Math.floor(value / 85);
        }
        result += encoded;
      }
      if (remainder !== 0) {
        result = result.slice(0, result.length - (4 - remainder));
      }
      return result;
    }

    // Multi encode
    function multipleBase85Encode(text, times) {
      let encoded = new TextEncoder().encode(text);
      for (let i = 0; i < times; i++) {
        let str = z85Encode(encoded);
        encoded = new TextEncoder().encode(str);
      }
      return new TextDecoder().decode(encoded);
    }

    // Wrap lines with numbers
    function wrapOutputWithLineNumbers(text, width) {
      let lines = [];
      for (let i = 0; i < text.length; i += width) {
        lines.push(((i / width) + 1).toString().padStart(3, ' ') + ": " + text.slice(i, i + width));
      }
      return lines;
    }

    // Main function
    function encodeBase85() {
      let text = document.getElementById("text").value;
      let times = parseInt(document.getElementById("times").value);
      let width = parseInt(document.getElementById("width").value);
      let line = document.getElementById("line").value;
      let output = document.getElementById("output");

      if (!text) {
        output.textContent = "❗ Zadaj text!";
        return;
      }
      if (times < 1) {
        output.textContent = "❗ Počet kódovaní musí byť aspoň 1.";
        return;
      }

      let result = multipleBase85Encode(text, times);
      let lines = wrapOutputWithLineNumbers(result, width);

      if (line) {
        let n = parseInt(line);
        if (n >= 1 && n <= lines.length) {
          output.textContent = lines[n - 1];
        } else {
          output.textContent = `❗ Text má iba ${lines.length} riadkov.`;
        }
      } else {
        output.textContent = lines.join("\n");
      }
    }
  </script>
</body>
</html>

